#include <stdio.h>
#include "pico/stdlib.h"
#include "hardware/gpio.h"

// Biblioteca gerada pelo arquivo .pio durante compilacao.
//#include "ws2818b.pio.h" descomentar para utilizá-la

// ------------------- Definições dos Pinos GPIO -------------------

// Definição dos pinos GPIO do teclado matricial
#define ROW_1    5
#define ROW_2    18
#define ROW_3    19
#define ROW_4    20
#define COL_1    21
#define COL_2    6
#define COL_3    22
#define COL_4    26


// Dimensões do teclado
#define NUM_LINHAS 4
#define NUM_COLUNAS 4

// ------------------- Inicialização dos GPIOs -------------------
void setup_gpio() {
    // ------------ Configuração das linhas (saída) ------------
    gpio_init(ROW_1);
    gpio_init(ROW_2);
    gpio_init(ROW_3);
    gpio_init(ROW_4);

    gpio_set_dir(ROW_1, GPIO_OUT);
    gpio_set_dir(ROW_2, GPIO_OUT);
    gpio_set_dir(ROW_3, GPIO_OUT);
    gpio_set_dir(ROW_4, GPIO_OUT);

    // Define todas as linhas em HIGH (1) inicialmente
    gpio_put(ROW_1, 1);
    gpio_put(ROW_2, 1);
    gpio_put(ROW_3, 1);
    gpio_put(ROW_4, 1);

    // ------------ Configuração das colunas (entrada, pull-up) ------------
    gpio_init(COL_1);
    gpio_init(COL_2);
    gpio_init(COL_3);
    gpio_init(COL_4);

    gpio_set_dir(COL_1, GPIO_IN);
    gpio_set_dir(COL_2, GPIO_IN);
    gpio_set_dir(COL_3, GPIO_IN);
    gpio_set_dir(COL_4, GPIO_IN);

    // Pull-up em cada coluna (0 = pressionado)
    gpio_pull_up(COL_1);
    gpio_pull_up(COL_2);
    gpio_pull_up(COL_3);
    gpio_pull_up(COL_4);

}

// ------------------- Leitura do Teclado Matricial -------------------
const char KEYPAD[NUM_LINHAS][NUM_COLUNAS] = {
    {'1', '2', '3', 'A'},
    {'4', '5', '6', 'B'},
    {'7', '8', '9', 'C'},
    {'*', '0', '#', 'D'}
};

char read_keypad() {
    // Arrays de linhas e colunas
    const uint rows[] = {ROW_1, ROW_2, ROW_3, ROW_4};
    const uint cols[] = {COL_1, COL_2, COL_3, COL_4};

    // Faz a varredura linha a linha
    for (int linha = 0; linha < 4; linha++) {
        // Coloca a linha atual em LOW (0) para "ativar"
        gpio_put(rows[linha], 0);

        // Lê cada coluna
        for (int coluna = 0; coluna < 4; coluna++) {
            // Se a coluna estiver em 0, significa tecla pressionada
            if (gpio_get(cols[coluna]) == 0) {
                sleep_ms(50); // Debounce

                if (gpio_get(cols[coluna]) == 0) {
                    // Espera o botão ser solto
                    while (gpio_get(cols[coluna]) == 0) {
                        sleep_ms(10);
                    }
                    // Desativa a linha (retorna a HIGH)
                    gpio_put(rows[linha], 1);

                    // Retorna o caractere correspondente
                    return KEYPAD[linha][coluna];
                }
            }
        }
        // Desativa a linha atual (HIGH)
        gpio_put(rows[linha], 1);
    }

    return '\0'; // Nenhuma tecla pressionada
}

//DEV 1
void tecla_zero();

//DEV 2
void tecla_um();
void funcao_A();

//DEV 3
void tecla_dois();
void funcaao_B();

//DEV 4
void tecla_tres(){
    stdio_init_all();
    npInit(LED_PIN);
    npClear();

    int matriz_pokebola[24][5][5][3]={
    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, // Linha superior (vermelho)
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, // Vermelho com centro preto
    {{255, 255, 255}, {0, 0, 0}, {255, 255, 255}, {0, 0, 0}, {255, 255, 255}}, // Linha do meio com preto e branco
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, // Branco
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},//Branco
    
    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 255, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 0, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {150, 150, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},   

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {190, 190, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {230, 230, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 255, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 255, 255}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 0, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {230, 0, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {190, 0, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {150, 0, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 255, 255}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 0, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 255, 255}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 0, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 0, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 255, 255}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {255, 255, 255}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {0, 255, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {0, 160, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {0, 255, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {0, 160, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}},

    {{{255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}, {255, 0, 0}}, 
    {{255, 0, 0}, {255, 0, 0}, {0, 0, 0},   {255, 0, 0}, {255, 0, 0}}, 
    {{255, 255, 255}, {0, 0, 0}, {0, 255, 0}, {0, 0, 0}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}, 
    {{255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}}}};

    while(true){ // Loop para alternar entre as matrizes

    for (int i = 0; i < 24; i++) // Itera pelas 24 matrizes
    {
      for (int linha = 0; linha < 5; linha++)
      {
        for (int coluna = 0; coluna < 5; coluna++)
        {
          int posicao = getIndex(linha, coluna);
          npSetLED(posicao, matriz_pokebola[i][linha][coluna][0], matriz_pokebola[i][linha][coluna][1], matriz_pokebola[i][linha][coluna][2]);
        }
      }
      npWrite();      // Atualiza os LEDs
      sleep_ms(1000); // Espera 1 segundo
      npClear();      // Limpa os LEDs
    }
  
         

    }

}

void funcao_C(){
    //trabalhando nela
    stdio_init_all();
    npInit(LED_PIN);
    npClear();

    int matriz_Vermelha[5][5][3]={
        {{255,0,0},{255,0,0},{255,0,0},{255,0,0},{255,0,0}},
        {{255,0,0},{255,0,0},{255,0,0},{255,0,0},{255,0,0}},
        {{255,0,0},{255,0,0},{255,0,0},{255,0,0},{255,0,0}},
        {{255,0,0},{255,0,0},{255,0,0},{255,0,0},{255,0,0}},
        {{255,0,0},{255,0,0},{255,0,0},{255,0,0},{255,0,0}}};

        ajustarBrilho(matriz_Vermelha,0.8); // Reduz o brilho pra 80%

        while(true){

            for(int linha=0; linha<5; linha++){

                for(int coluna=0; coluna>5; coluna++){

                    int posicao = getIndex(linha, coluna);

                    npSetLED(posicao,matriz_Vermelha[linha][coluna][0],matriz_Vermelha[linha][coluna][1],matriz_Vermelha[linha][coluna][2]);
                }
            }
        }
        
        npWrite();
        sleep_ms(1000);
        npClear();
        sleep_ms(500);
        
    }


//DEV 5
void tecla_quatro();
void funcao_D();

//DEV 6
void tecla_cinco();
void funcao_sharp();


int main() {
    stdio_init_all();
    setup_gpio();

    printf("Sistema iniciado. Pressione uma tecla no teclado matricial.\n");
    
    while (true) {
        char tecla = read_keypad();
        if (tecla != '\0') {
            printf("Tecla '%c' pressionada.\n", tecla);


            // verifica se a tecla pressionada é '3'
            if(tecla == '3'){
                tecla_tres();
            }

            // verifica se a tecla pressionada é 'C'
            if(tecla == 'C'){
                funcao_C();
            }


            
        }
        sleep_ms(100); // Pequena pausa para evitar sobrecarga do loop
    }
    
    return 0;
}
